# app目录结构与功能说明

本文档提供了项目app目录的详细说明，包括各个子目录和文件的功能、用途和相互关系。

## 目录结构

```
app/
├── (auth)/                 # 认证相关页面
│   ├── sign-in/            # 登录页面
│   ├── sign-up/            # 注册页面
│   ├── actions.ts          # 认证相关服务器操作
│   └── layout.tsx          # 认证页面布局
├── (dashboard)/            # 仪表板相关页面
│   ├── account/            # 账户设置页面
│   ├── activity/           # 活动日志页面
│   ├── api-keys/           # API密钥管理页面
│   ├── team/               # 团队管理页面
│   ├── layout.tsx          # 仪表板布局
│   └── page.tsx            # 仪表板首页
├── (marketing)/            # 营销相关页面
│   ├── blog/               # 博客页面
│   ├── docs/               # 文档页面
│   ├── pricing/            # 定价页面
│   ├── layout.tsx          # 营销页面布局
│   └── page.tsx            # 首页
├── api/                    # API路由
│   ├── activity/           # 活动日志API
│   ├── api-keys/           # API密钥管理API
│   ├── plans/              # 订阅计划API
│   ├── stripe/             # Stripe相关API
│   ├── team/               # 团队API
│   └── user/               # 用户API
├── globals.css             # 全局样式
├── layout.tsx              # 根布局
└── not-found.tsx           # 404页面
```

## 路由组说明

Next.js 14的App Router使用目录结构定义路由，括号中的目录名称表示路由组，不会影响URL路径。

### (auth) - 认证路由组

认证路由组包含与用户认证相关的页面，如登录和注册。

**主要文件：**

- **sign-in/page.tsx**: 登录页面，提供用户登录表单
- **sign-up/page.tsx**: 注册页面，提供用户注册表单
- **actions.ts**: 包含认证相关的服务器操作，如登录、注册和登出
- **layout.tsx**: 为认证页面提供统一的布局，通常包含简化的页面结构

**功能特点：**

- 表单验证和错误处理
- 密码哈希和安全存储
- JWT会话管理
- 登录状态重定向（已登录用户重定向到仪表板）

### (dashboard) - 仪表板路由组

仪表板路由组包含用户登录后可访问的功能页面，如概览、团队管理和API密钥管理。

**主要文件：**

- **page.tsx**: 仪表板首页，显示概览信息
- **account/page.tsx**: 账户设置页面，允许用户管理个人信息
- **activity/page.tsx**: 活动日志页面，显示用户活动历史
- **api-keys/page.tsx**: API密钥管理页面，允许用户创建和管理API密钥
- **team/page.tsx**: 团队管理页面，允许用户管理团队成员
- **layout.tsx**: 为仪表板页面提供统一的布局，通常包含侧边栏导航

**功能特点：**

- 受保护的路由（需要用户登录）
- 数据获取和状态管理
- 实时更新（使用SWR）
- 响应式设计

### (marketing) - 营销路由组

营销路由组包含面向公众的页面，如首页、博客、文档和定价页面。

**主要文件：**

- **page.tsx**: 首页，展示产品特点和主要功能
- **blog/page.tsx**: 博客页面，展示博客文章
- **docs/page.tsx**: 文档页面，提供产品文档
- **pricing/page.tsx**: 定价页面，展示订阅计划和价格
- **layout.tsx**: 为营销页面提供统一的布局，通常包含页眉和页脚

**功能特点：**

- 公开访问（无需登录）
- SEO优化
- 响应式设计
- 营销内容展示

## API路由说明

API路由提供后端API端点，用于前端和外部服务的数据交互。

### activity - 活动日志API

- **route.ts**: 提供活动日志的获取和创建功能

### api-keys - API密钥管理API

- **route.ts**: 提供API密钥的创建、获取和列表功能
- **[id]/route.ts**: 提供特定API密钥的撤销功能

### plans - 订阅计划API

- **route.ts**: 提供订阅计划的获取功能

### stripe - Stripe相关API

- **checkout/route.ts**: 处理Stripe结账成功回调
- **webhook/route.ts**: 处理Stripe webhook事件

### team - 团队API

- **route.ts**: 提供团队信息的获取功能

### user - 用户API

- **route.ts**: 提供用户信息的获取功能

## 根文件说明

### layout.tsx

根布局文件，为整个应用提供全局布局和配置。

**主要功能：**

- 设置HTML和body标签
- 配置主题提供者
- 配置SWR数据获取
- 设置通知提示组件

### globals.css

全局CSS文件，包含全局样式定义和Tailwind CSS配置。

### not-found.tsx

404页面，当用户访问不存在的路由时显示。

## 页面组件结构

大多数页面组件遵循以下结构：

1. **页面组件**: 定义在page.tsx文件中，负责页面的整体结构和数据获取
2. **客户端组件**: 使用"use client"指令的交互组件，处理用户交互和状态管理
3. **服务器组件**: 默认的服务器端渲染组件，负责数据获取和初始渲染
4. **服务器操作**: 定义在actions.ts文件中，处理表单提交和数据修改

## 数据获取策略

项目使用多种数据获取策略：

1. **服务器组件数据获取**: 直接在服务器组件中获取数据
2. **SWR客户端数据获取**: 使用SWR在客户端获取和缓存数据
3. **服务器操作**: 使用服务器操作处理表单提交和数据修改

## 布局嵌套

布局文件按以下顺序嵌套：

1. **根布局** (app/layout.tsx): 提供全局配置和主题
2. **路由组布局** (app/(group)/layout.tsx): 提供特定路由组的布局
3. **子路由布局** (app/(group)/[route]/layout.tsx): 提供特定子路由的布局

## 路由保护

仪表板路由组使用中间件进行路由保护：

1. 检查用户是否已登录
2. 如果未登录，重定向到登录页面
3. 如果已登录，允许访问请求的页面

## 页面元数据

页面使用Next.js的元数据API定义SEO相关信息：

```tsx
export const metadata = {
  title: '页面标题',
  description: '页面描述'
};
```

## 静态和动态渲染

项目根据页面类型使用不同的渲染策略：

1. **静态渲染**: 用于营销页面，提高性能和SEO
2. **动态渲染**: 用于仪表板页面，确保数据实时性
3. **流式渲染**: 用于包含多个数据源的页面，提高用户体验
